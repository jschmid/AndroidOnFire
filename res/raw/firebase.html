<html>
  <head>
    <script type='text/javascript' src='http://static.firebase.com/v0/firebase.js'></script>
  </head>
  <body style="background: red;">
  	<script type='text/javascript'>

	var bases = {};
	var methods = {};
	
	function getBase(endpoint) {
		var base = bases[endpoint];
		if(base == null) {
			bases[endpoint] = new Firebase(endpoint);
			base = bases[endpoint];
		}
		return base;
	}
	
	function on(endpoint, ev, methodId) {
		
		var m = function(snapshot, prevChildName) {
			var name = snapshot.name();
			var message = snapshot.val();
			var val = JSON.stringify(message);
			Android.onEvent(endpoint, methodId, name, val, prevChildName);
		};
		methods[methodId] = m;
		
		getBase(endpoint).on(ev, m);
	}
	
	function off(endpoint, ev, methodId) {


		if(ev === undefined) {
			getBase(endpoint).off();
		} else if(methodId === undefined) {
			getBase(endpoint).off(ev);
		} else {
			var m = methods[methodId];
			if(m == null) {
				return;
			}
			
			getBase(endpoint).off(ev, m);
		}
	}
	
	function set(endpoint, obj) {
		getBase(endpoint).set(obj);
	}
	
	function push(endpoint, obj) {
		var parent = getBase(endpoint);
		var pushed = parent.push(obj);
		var name = pushed.name();
		var fullName = parent.toString() + '/' + name;
		bases[fullName] = pushed;
		Android.pushed(name);
	}

	function remove(endpoint) {
		getBase(endpoint).remove();
		delete bases[endpoint];
	}
	
    </script>
  </body>
</html>